
services:
  livekit:
    image: docker.io/library/livekit-image
    # image: docker.io/library/ssi-image
    # image: docker.io/library/pyphoto
    volumes:
      - /run/user/0:/tmp # Required for wayland in /run/user/0/wayland-0
      - /run/pulse:/tmp/pulse # Required to access pulseaudio
      - /run/user/1000/bus:/run/user/1000/bus # Session bus
      - /home/charlee-clay/straces:/home/saltoks/straces # Storing traces to mounted volume
      - /home/charlee-clay/files:/home/saltoks/files # Where I put my adapted startup.sh so I can change quickly
      - /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket # Accessing networkmanager (apparently)
      - /home/charlee-clay/config:/home/saltoks/.local/share/io.livekit.example.example/ # Where livekit searches preexisting config
    environment:
      - XDG_RUNTIME_DIR=/tmp
      - WAYLAND_DISPLAY=wayland-0
      - DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus
    user:
      0:0
    devices:
      - /dev/video0
      - /dev/video1
    group_add:
      - video
      # - adm
    security_opt:
      - "apparmor:unconfined"

    # network_mode: "host"

    stdin_open: true
    tty: true

    # Uncomment if it is failing and you want to debug.
    # In that case, run compose with -d to detach, and afterwards run compose exec intercom /bin/bash
    # entrypoint:
      # - /bin/bash
      # - /home/saltoks/foo/mystartup.sh
      # - /home/saltoks/example


# sudo docker run --privileged --device /dev/snd --device /dev/dri --group-add video --group-add adm -v /run/user/0:/run/user/0 -v $XDG_RUNTIME_DIR/pulse/audio:/tmp/pulse/audio -v /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket -u 0:0 --device /dev/video0 --device /dev/video1 --security-opt apparmor:unconfined -e XDG_RUNTIME_DIR=/run/user/0 -e WAYLAND_DISPLAY=wayland-0 e DISPLAY=:0 -e DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus -v /run/user/1000/bus:/run/user/1000/bus -v /home/charlee-clay/straces:/tmp/straces docker.io/library/ssi-image strace -o /tmp/straces/strace1.log ./ssi_app_intercom_outdoor